name: 'IOS Appium Workflow Action'

on:
  push:
    branches: main
jobs:
  test_job:
    runs-on: macos-latest
    steps:
      - name: Get an available iOS simulator and boot it
        uses: ThangNguyen0495/create-ios-simulator@main
        
      - name: Checkout code
        uses: actions/checkout@v4
  
      - name: Set up JDK
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: ${{ inputs.java_version }}
  
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: ${{ inputs.node_version }}
  
      - name: Install Appium
        run: npm install -g appium > /dev/null 2>&1
        
  
      - name: Install FFmpeg
        run: brew install ffmpeg > /dev/null 2>&1
        
  
      - name: Install Carthage
        run: brew install carthage > /dev/null 2>&1
  
      - name: Install XCUITest driver
        run: appium driver install xcuitest > /dev/null 2>&1

      - name: Install WDA
        run: |
          cd ~/.appium/node_modules/appium-xcuitest-driver/node_modules/appium-webdriveragent
          nohup xcodebuild test-without-building \
            -project WebDriverAgent.xcodeproj \
            -derivedDataPath wda_build \
            -scheme WebDriverAgentRunner \
            -destination "platform=iOS Simulator,name=$DEVICE_NAME" \
            CODE_SIGNING_ALLOWED=NO > wda.log 2>&1 &

          cat wda.log
      - name: Check installed app
        run: |
          xcrun simctl listapps booted

      # - name: Start Appium server
      #   run: nohup appium -a 0.0.0.0 -p 4723 -pa /wd/hub --relaxed-security> appium_log.txt 2>&1 & > /dev/null 2>&1
      
