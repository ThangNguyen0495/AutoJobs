name: Start Selenium Grid

on:
  workflow_dispatch:

jobs:
  start-grid:
    runs-on: [self-hosted, selenium-cloud]

    steps:
      - name: Pull Selenium Grid images
        run: |
          docker pull selenium/hub:4.25.0
          docker pull selenium/node-chrome:4.25.0

      - name: Start Selenium Grid
        run: |
          docker network create grid || true
          docker run -d -p 4442-4444:4442-4444 --net grid --name selenium-hub selenium/hub:4.25.0
          docker run -d --net grid -e SE_EVENT_BUS_HOST=selenium-hub \
            -e SE_EVENT_BUS_PUBLISH_PORT=4442 -e SE_EVENT_BUS_SUBSCRIBE_PORT=4443 \
            --shm-size="2g" selenium/node-chrome:4.25.0

      - name: Log Grid URL
        run: |
          # Get public IP (if VM has internet)
          PUBLIC_IP=$(curl -s ifconfig.me || echo "localhost")
          
          echo ""
          echo "âœ… Selenium Grid Hub is up and running!"
          echo "-----------------------------------------"
          echo "Hub Console URL:  http://$PUBLIC_IP:4444/ui"
          echo "Hub Endpoint:     http://$PUBLIC_IP:4444/wd/hub"
          echo "-----------------------------------------"
          echo ""

          # Optional: check health
          curl -s http://localhost:4444/status | jq '.value.ready' || true
