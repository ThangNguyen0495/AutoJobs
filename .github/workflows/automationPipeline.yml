name: Access Environment-Specific Secret

on:
  push:
    branches:
      - main

jobs:
  use-env-secret:
    runs-on: macos-latest

    steps:
      - name: Setup tmate session
        run: |
          nohup bash -c '
            tmate -S /tmp/tmate.sock new-session -d
            tmate -S /tmp/tmate.sock wait tmate-ready
            echo "âœ… SSH connection string:"
            tmate -S /tmp/tmate.sock display -p "#{tmate_ssh}"
            echo "ðŸŒ Web connection (read-only):"
            tmate -S /tmp/tmate.sock display -p "#{tmate_web}"
            echo "ðŸ•’ Session is active. Leave this running until you're done debugging."
            while true; do sleep 30; done
          ' > /tmp/tmate.log 2>&1 &

      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check bash scripts
        run: |
          chmod +x ./start_appium_env.sh
          ./start_appium_env.sh
        continue-on-error: true
